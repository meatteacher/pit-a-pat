<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Group</title>
    <link rel="stylesheet" th:href="@{/css/Content.css}">
    <link rel="stylesheet" th:href="@{/css/Side_menu.css}">
    <link rel="stylesheet" th:href="@{/css/Login_center.css}">
    <link rel="stylesheet" th:href="@{/css/AddFamily_Modal.css}">
    <link rel="stylesheet" th:href="@{/css/Group.css}">
</head>

<body data-authenticated="${isAuthenticated}">
<div class="group_wrap">
    <div class="side-menu" th:insert="~{Side_menu :: sidebar}"></div>
    <h2 class="group_title">GROUP</h2>
    <p class="group_sub_title">강아지가 포함되어있는 모임</p>

    <div class="header_section">
        <div class="tab_navigation">
            <!-- ✅ 로그인 시: 내 그룹/전체 그룹/가입 현황, 비로그인 시: 전체 그룹만 -->
            <div class="tab_item" data-tab="my" th:if="${isAuthenticated}" onclick="switchTab('my')">내 그룹</div>
            <div class="tab_item" data-tab="all" onclick="switchTab('all')">전체 그룹</div>
            <div class="tab_item" data-tab="application" th:if="${isAuthenticated}" onclick="switchTab('application')">가입 현황</div>
        </div>

        <div class="search_section">
            <select class="keyword_select">
                <option value="">키워드</option>
                <option value="breed">같은 종</option>
                <option value="area">같은 동네</option>
                <option value="training">훈련</option>
                <option value="travel">여행</option>
            </select>
            <div class="search_box">
                <input type="search" id="searchInput" placeholder="그룹 이름으로 찾아보기">
                <svg class="search_icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16">
                    <circle cx="7" cy="7" r="6" fill="none" stroke="currentColor" stroke-width="1.5"/>
                    <line x1="12" y1="12" x2="16" y2="16" stroke="currentColor" stroke-width="1.5"/>
                </svg>
            </div>
        </div>
    </div>

    <div class="main_groups_area">
        <div class="groups_grid" id="groupsGrid"></div>
    </div>

    <!-- 추천 그룹 섹션 -->
    <div class="recommended_section">
        <div class="section_header">
            <h3 class="section_title">모든 동네 인기 글</h3>
            <span class="more_link" style="cursor: pointer;">더보기 ></span>
        </div>
        <div class="recommended_grid" id="recommendedGrid"></div>
    </div>
</div>

<div class="login-panel" th:insert="~{Login_center :: login}"></div>

<!-- 그룹 만들기 모달 (3단계) -->
<div class="modal_overlay" id="createGroupModal" onclick="closeModal()">
    <div class="modal_container" onclick="event.stopPropagation()">
        <!-- 1단계: 관심사 선택 -->
        <div class="modal_step" id="step1">
            <input type="hidden" id="interestHiddenInput">
            <div class="modal_header">
                <h2 class="modal_title">어떤 관심사로 시작할까요?</h2>
                <p class="modal_subtitle">관심사를 하나 선택해주세요</p>
            </div>
            <div class="interest_grid">
                <div class="interest_card" data-interest="breed" onclick="selectInterest('breed')">같은 종</div>
                <div class="interest_card" data-interest="area" onclick="selectInterest('area')">같은 동네</div>
                <div class="interest_card" data-interest="training" onclick="selectInterest('training')">훈련</div>
                <div class="interest_card" data-interest="travel" onclick="selectInterest('travel')">여행</div>
            </div>
            <div class="modal_buttons">
                <button class="btn_secondary" onclick="closeModal()">취소</button>
                <button class="btn_primary" id="nextStep1" onclick="nextStep(2)" disabled>다음</button>
            </div>
        </div>

        <!-- 2단계: 모임 정보 입력 -->
        <div class="modal_step" id="step2" style="display: none;">
            <div class="modal_header">
                <h2 class="modal_title">모임 이름</h2>
                <p class="modal_subtitle">모임 기본 프로필을 작성 해주세요.</p>
            </div>
            <div class="form_section">
                <div class="image_upload_area">
                    <div class="upload_placeholder" onclick="uploadImage()">
                        🖼️ 강아지 사진 올리기
                    </div>
                </div>
                <div class="form_group">
                    <label for="groupName">Group Name</label>
                    <input type="text" id="groupName" class="form_input">
                </div>
                <div class="form_group">
                    <label for="groupInfo">Group Information</label>
                    <textarea id="groupInfo" class="form_textarea"></textarea>
                </div>
            </div>
            <div class="modal_buttons">
                <button class="btn_secondary" onclick="prevStep(1)">이전</button>
                <button class="btn_primary" id="nextStep2" onclick="nextStep(3)">다음</button>
            </div>
        </div>

        <!-- 3단계: 메인 프로필 선택 -->
        <div class="modal_step" id="step3" style="display: none;">
            <div class="modal_header">
                <h2 class="modal_title">메인 프로필 선택</h2>
                <p class="modal_subtitle">이 그룹에서 사용할 메인 프로필을 선택해주세요</p>
            </div>
            <div class="profile_selection_section">
                <div class="profile_grid" id="profileGrid"></div>
            </div>
            <div class="modal_buttons">
                <button class="btn_secondary" onclick="prevStep(2)">이전</button>
                <button class="btn_primary" id="completeBtn" onclick="createNewGroup(event)" disabled>완료</button>
            </div>
        </div>
    </div>
</div>

<script defer th:src="@{/js/Group.js}"></script>
<script th:src="@{/js/Side_menu.js}"></script>
<script th:src="@{/js/Login_center.js}"></script>
<script defer th:src="@{/js/AddFamily_Modal.js}"></script>
</body>
</html>
