<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Trail 시각화</title>
    <style>
        #map { width:100%; height:400px; }
    </style>
    <!-- 네이버 지도 JS (ncpClientId에 발급받은 키 넣기) -->
    <script src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=8rmgkdfw2q"></script>
    <script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>
</head>
<body>
<h3 th:text="${trail.name}">Trail 이름</h3>
<div id="map"></div>

<script th:inline="javascript">
    /*<![CDATA[*/
    const trailId = /*[[${trail.id}]]*/ 0;
    fetch(`/trail/${trailId}/path`)
        .then(res => {
            if (!res.ok) throw new Error(`서버 응답 ${res.status}`);
            return res.json();
        })
        .then(path => {
            if (!Array.isArray(path) || path.length === 0) {
                alert('경로 데이터가 없습니다.');
                return;
            }

            // — 여기를 고칩니다 —
            const first = path[0];
            const map = new naver.maps.Map('map', {
                center: new naver.maps.LatLng(first.lat, first.lng),
                zoom: 14
            });

            // Polyline 그릴 좌표 배열
            const coords = path.map(p => new naver.maps.LatLng(p.lat, p.lng));

            const polyline = new naver.maps.Polyline({
                map,
                path: coords,
                strokeColor: '#3366FF',
                strokeWeight: 5,
                strokeOpacity: 0.8
            });

            const bounds = new naver.maps.LatLngBounds();
            coords.forEach(pt => bounds.extend(pt));
            map.fitBounds(bounds);
        })
        .catch(err => console.error(err));
    /*]]>*/
</script>

</body>
</html>
